jQuery(document).ready(function ($) {
    // Insert icon picker container
    // $("body").prepend(`
    //     <div class="howl-iconpicker-outer">
    //         <div class="howl-iconpicker-middle">
    //             <div class="howl-iconpicker">
    //                 <div class="howl-closebtn"></div>
    //                 <input type="text" class="srchicons" placeholder="eg: google" />
    //                 <div class="iconsholder"></div>
    //             </div>
    //             <div class="howl-iconpicker-close"></div>
    //         </div>
    //     </div>
    // `);

    // Font Awesome icons list
    const icons = `
        address-book
    `.trim().split(/\s+/);

    // Populate icons
    const iconContainer = $(".howl-iconpicker .iconsholder");
    icons.forEach(icon => {
        iconContainer.append(`
            <p class="geticonval hidden">
                <i class="fa fa-${icon}"></i>
            </p>
        `);
    }); 

    // Search filter
    $(".howl-iconpicker .srchicons").on("keyup", function () {
        const query = $(this).val().toLowerCase();
        $(".howl-iconpicker .geticonval").each(function () {
            const text = $(this).text().toLowerCase();
            $(this).toggle(text.includes(query));
        });
    });

    // Close button
    $(".howl-iconpicker-close").on("click", function () {
        $(".howl-iconpicker-outer").hide();
    });

    // Prevent click propagation
    $(".howl-iconpicker").on("click", function (e) {
        e.stopPropagation();
    });

    // Click outside to close
    $(".howl-iconpicker-outer").on("click", function () {
        $(this).hide();
    });
});

// Plugin definition
(function ($) {
    $.fn.iconpicker = function (targetInput) {
        $(this).on("focusin", function () {
            $(".howl-iconpicker-outer").css("display", "table");
            $(".howl-iconpicker .geticonval").removeClass("selectedicon");

            const inputClass = $(this).attr("class");
            const inputId = $(this).attr("id");

            $(".howl-iconpicker .geticonval").off("click").on("click", function () {
                const iconName = $(this).text().trim();
                $(".howl-iconpicker .geticonval").removeClass("selectedicon");
                $(this).addClass("selectedicon");

                if ($(targetInput).attr("class") === inputClass &&
                    $(targetInput).attr("id") === inputId) {
                    $(targetInput).val("fa-" + iconName).trigger("change");
                }
            });
        });
    };
})(jQuery);
